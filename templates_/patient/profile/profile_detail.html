{% extends "patient/assets/base.html" %}
{% load static %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">My Profile</h1>
                    <p class="text-gray-600 mt-1">View and manage your personal information</p>
                </div>
                <a href="{% url 'patient:profile_edit' %}" 
                   class="btn btn-primary">
                    <i class="fas fa-edit mr-2"></i>Edit Profile
                </a>
            </div>
        </div>

        <!-- Profile Completeness -->
        <div class="card bg-white shadow-sm border border-gray-200 mb-8">
            <div class="card-body">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Profile Completeness</h3>
                
                <div class="mb-4">
                    <div class="flex justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700">{{ completeness.percentage }}% Complete</span>
                        <span class="text-sm text-gray-500">{{ completeness.filled }}/{{ completeness.total }} fields</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div class="bg-{% if completeness.is_complete %}green{% else %}blue{% endif %}-600 h-2.5 rounded-full" 
                             style="width: {{ completeness.percentage }}%"></div>
                    </div>
                </div>
                
                {% if not completeness.is_complete %}
                <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
                    <div class="flex">
                        <i class="fas fa-exclamation-circle text-amber-500 mt-1 mr-3"></i>
                        <div>
                            <p class="text-sm text-amber-800 font-medium mb-2">Complete your profile</p>
                            <p class="text-sm text-amber-700">Missing fields: {{ completeness.missing_fields|join:", " }}</p>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Personal Information -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Left Column -->
            <div class="space-y-8">
                <!-- Basic Information -->
                <div class="card bg-white shadow-sm border border-gray-200">
                    <div class="card-body">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-user-circle mr-2 text-blue-600"></i>Basic Information
                        </h3>
                        <dl class="space-y-3">
                            <div class="flex justify-between">
                                <dt class="text-sm font-medium text-gray-500">Full Name</dt>
                                <dd class="text-sm text-gray-900">{{ patient.first_name }} {{ patient.last_name }}</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt class="text-sm font-medium text-gray-500">Date of Birth</dt>
                                <dd class="text-sm text-gray-900">{{ patient.date_of_birth|date:"F d, Y"|default:"Not set" }}</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt class="text-sm font-medium text-gray-500">Gender</dt>
                                <dd class="text-sm text-gray-900">{{ patient.get_gender_display|default:"Not set" }}</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt class="text-sm font-medium text-gray-500">Patient ID</dt>
                                <dd class="text-sm font-medium text-gray-900">{{ patient.patient_id }}</dd>
                            </div>
                        </dl>
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="card bg-white shadow-sm border border-gray-200">
                    <div class="card-body">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-phone-alt mr-2 text-green-600"></i>Contact Information
                        </h3>
                        <dl class="space-y-3">
                            <div class="flex justify-between">
                                <dt class="text-sm font-medium text-gray-500">Email</dt>
                                <dd class="text-sm text-gray-900">{{ user.email }}</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt class="text-sm font-medium text-gray-500">Phone</dt>
                                <dd class="text-sm text-gray-900">{{ patient.contact_phone|default:"Not set" }}</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt class="text-sm font-medium text-gray-500">Email Verified</dt>
                                <dd>
                                    <span class="badge {% if patient_user.email_verified %}badge-success{% else %}badge-warning{% endif %}">
                                        {% if patient_user.email_verified %}Verified{% else %}Not Verified{% endif %}
                                    </span>
                                </dd>
                            </div>
                        </dl>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="space-y-8">
                <!-- Account Settings -->
                <div class="card bg-white shadow-sm border border-gray-200">
                    <div class="card-body">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-cog mr-2 text-purple-600"></i>Account Settings
                        </h3>
                        <dl class="space-y-3">
                            <div class="flex justify-between">
                                <dt class="text-sm font-medium text-gray-500">Notification Preference</dt>
                                <dd class="text-sm text-gray-900">{{ patient_user.get_preferred_notification_display }}</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt class="text-sm font-medium text-gray-500">Language</dt>
                                <dd class="text-sm text-gray-900">{{ patient_user.get_language_preference_display|default:"English" }}</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt class="text-sm font-medium text-gray-500">Timezone</dt>
                                <dd class="text-sm text-gray-900">{{ patient_user.timezone }}</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt class="text-sm font-medium text-gray-500">Digital Results Consent</dt>
                                <dd>
                                    <span class="badge {% if patient_user.consent_to_digital_results %}badge-success{% else %}badge-error{% endif %}">
                                        {% if patient_user.consent_to_digital_results %}Granted{% else %}Not Granted{% endif %}
                                    </span>
                                </dd>
                            </div>
                        </dl>
                    </div>
                </div>

                <!-- Account Information -->
                <div class="card bg-white shadow-sm border border-gray-200">
                    <div class="card-body">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-calendar-alt mr-2 text-amber-600"></i>Account Information
                        </h3>
                        <dl class="space-y-3">
                            <div class="flex justify-between">
                                <dt class="text-sm font-medium text-gray-500">Member Since</dt>
                                <dd class="text-sm text-gray-900">{{ patient.created_at|date:"F d, Y" }}</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt class="text-sm font-medium text-gray-500">Last Profile Update</dt>
                                <dd class="text-sm text-gray-900">{{ patient.updated_at|date:"F d, Y" }}</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt class="text-sm font-medium text-gray-500">Last Login</dt>
                                <dd class="text-sm text-gray-900">{{ patient_user.last_portal_login|date:"F d, Y h:i A"|default:"Never" }}</dd>
                            </div>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}