{% extends "laboratory/assets/base_apt.html" %}

{% load static %}


{% block content %}
    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <!-- Header Section -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold text-lab-black mb-2">Appointment Slot Templates</h1>
                <p class="text-gray-600">Create and manage templates for recurring appointment slots</p>
            </div>
            
            <!-- Create Template Button -->
            <a href="{% url 'appointment:slot_template_create' %}" class="mt-4 md:mt-0 inline-flex items-center px-5 py-3 bg-lab-red hover:bg-lab-red-light text-white font-medium rounded-lg transition-colors shadow-md hover:shadow-lg">
                <i class="fas fa-plus-circle mr-2"></i> Create New Template
            </a>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-navy">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Total Templates</p>
                        <p class="text-2xl font-bold text-lab-black mt-1">{{ templates|length }}</p>
                    </div>
                    <i class="fas fa-layer-group text-navy text-2xl"></i>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-lab-red">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Active Templates</p>
                        <p class="text-2xl font-bold text-lab-black mt-1">{{ templates|length }}</p>
                    </div>
                    <i class="fas fa-check-circle text-lab-red text-2xl"></i>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-green-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Generated Slots</p>
                        <p class="text-2xl font-bold text-lab-black mt-1">--</p>
                    </div>
                    <i class="fas fa-calendar-day text-green-500 text-2xl"></i>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-purple-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Upcoming Appointments</p>
                        <p class="text-2xl font-bold text-lab-black mt-1">--</p>
                    </div>
                    <i class="fas fa-clock text-purple-500 text-2xl"></i>
                </div>
            </div>
        </div>

        <!-- Templates Grid -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-xl font-semibold text-lab-black">Slot Templates</h2>
            </div>
            
            {% if templates %}
            <div class="overflow-x-auto custom-scrollbar">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Template Name</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time & Duration</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Recurrence</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Capacity & Type</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for template in templates %}
                        <tr class="hover:bg-gray-50 transition-colors">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 h-10 w-10 bg-navy-light bg-opacity-10 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-calendar-alt text-navy"></i>
                                    </div>
                                    <div class="ml-4">
                                        <div class="text-sm font-medium text-lab-black">{{ template.name }}</div>
                                        <div class="text-xs text-gray-500">Created {{ template.created_at|date:"M d, Y" }}</div>
                                    </div>
                                </div>
                            </td>
                            
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-lab-black font-medium">
                                    {{ template.start_time|time:"g:i A" }} - {{ template.end_time|time:"g:i A" }}
                                </div>
                                <div class="text-xs text-gray-500">{{ template.duration_minutes }} minutes per slot</div>
                            </td>
                            
                            <td class="px-6 py-4">
                                <div class="text-sm text-lab-black">
                                    {{ template.get_recurrence_pattern_display }}
                                </div>
                                {% if template.recurrence_pattern == 'specific_days' %}
                                <div class="mt-1 flex flex-wrap gap-1">
                                    {% if template.monday %}<span class="day-badge bg-blue-100 text-blue-800">Mon</span>{% endif %}
                                    {% if template.tuesday %}<span class="day-badge bg-blue-100 text-blue-800">Tue</span>{% endif %}
                                    {% if template.wednesday %}<span class="day-badge bg-blue-100 text-blue-800">Wed</span>{% endif %}
                                    {% if template.thursday %}<span class="day-badge bg-blue-100 text-blue-800">Thu</span>{% endif %}
                                    {% if template.friday %}<span class="day-badge bg-blue-100 text-blue-800">Fri</span>{% endif %}
                                    {% if template.saturday %}<span class="day-badge bg-purple-100 text-purple-800">Sat</span>{% endif %}
                                    {% if template.sunday %}<span class="day-badge bg-purple-100 text-purple-800">Sun</span>{% endif %}
                                </div>
                                {% endif %}
                            </td>
                            
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-lab-black">
                                    <span class="font-semibold">{{ template.max_appointments }}</span> appointments/slot
                                </div>
                                <div>
                                    <span class="text-xs px-2 py-1 rounded-full {% if template.slot_type == 'sample_collection' %}badge-sample-collection{% elif template.slot_type == 'consultation' %}badge-consultation{% elif template.slot_type == 'result_discussion' %}badge-result-discussion{% else %}badge-general{% endif %}">
                                        {{ template.get_slot_type_display }}
                                    </span>
                                </div>
                            </td>
                            
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-3 py-1 text-xs rounded-full {% if template.is_active %}status-active{% else %}status-inactive{% endif %}">
                                    {% if template.is_active %}
                                    <i class="fas fa-circle text-xs mr-1"></i> Active
                                    {% else %}
                                    <i class="fas fa-circle text-xs mr-1"></i> Inactive
                                    {% endif %}
                                </span>
                            </td>
                            
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                <div class="flex items-center space-x-3">
                                    <!-- Generate Slots -->
                                    <a href="{% url 'appointment:slot_template_generate' %}" 
                                       class="text-lab-red hover:text-lab-red-light transition-colors" 
                                       title="Generate Slots">
                                        <i class="fas fa-calendar-plus text-lg"></i>
                                    </a>
                                    
                                    <!-- Edit -->
                                    <a href="{% url 'appointment:slot_template_edit' template.id %}" 
                                       class="text-navy hover:text-navy-light transition-colors" 
                                       title="Edit Template">
                                        <i class="fas fa-edit text-lg"></i>
                                    </a>
                                    
                                    <!-- Delete -->
                                    <button onclick="confirmDelete({{ template.id }})" 
                                            class="text-lab-red hover:text-lab-red-light transition-colors" 
                                            title="Delete Template">
                                        <i class="fas fa-trash-alt text-lg"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <!-- Empty State -->
            <div class="text-center py-12">
                <div class="mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-6">
                    <i class="fas fa-calendar-alt text-gray-400 text-3xl"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-900 mb-2">No slot templates yet</h3>
                <p class="text-gray-500 mb-6 max-w-md mx-auto">
                    Create your first appointment slot template to start generating recurring appointment slots.
                </p>
                <a href="{% url 'appointment:slot_template_create' %}" class="inline-flex items-center px-5 py-3 bg-lab-red hover:bg-lab-red-light text-white font-medium rounded-lg transition-colors shadow-md hover:shadow-lg">
                    <i class="fas fa-plus-circle mr-2"></i> Create Your First Template
                </a>
            </div>
            {% endif %}
        </div>

        <!-- Quick Actions Card -->
        <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <div class="w-12 h-12 bg-lab-red-light bg-opacity-10 rounded-lg flex items-center justify-center">
                            <i class="fas fa-calendar-day text-lab-red text-xl"></i>
                        </div>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-medium text-lab-black mb-2">View Slot Calendar</h3>
                        <p class="text-gray-600 text-sm mb-4">See all generated appointment slots in calendar view</p>
                        <a href="{% url 'appointment:slot_calendar_view' %}" class="text-lab-red hover:text-lab-red-light font-medium text-sm inline-flex items-center">
                            Go to Calendar <i class="fas fa-arrow-right ml-1 text-xs"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <div class="w-12 h-12 bg-navy bg-opacity-10 rounded-lg flex items-center justify-center">
                            <i class="fas fa-list-alt text-navy text-xl"></i>
                        </div>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-medium text-lab-black mb-2">Manage Appointments</h3>
                        <p class="text-gray-600 text-sm mb-4">View and manage patient appointments</p>
                        <a href="{% url 'appointment:staff_appointment_list' %}" class="text-navy hover:text-navy-light font-medium text-sm inline-flex items-center">
                            View Appointments <i class="fas fa-arrow-right ml-1 text-xs"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <div class="w-12 h-12 bg-green-500 bg-opacity-10 rounded-lg flex items-center justify-center">
                            <i class="fas fa-bolt text-green-500 text-xl"></i>
                        </div>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-medium text-lab-black mb-2">Quick Generation</h3>
                        <p class="text-gray-600 text-sm mb-4">Generate slots for the next 30 days from all active templates</p>
                        <button class="text-green-600 hover:text-green-700 font-medium text-sm inline-flex items-center">
                            Bulk Generate <i class="fas fa-arrow-right ml-1 text-xs"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50 overflow-y-auto h-full w-full flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-4">
            <div class="p-6">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 bg-lab-red bg-opacity-10 rounded-lg flex items-center justify-center mr-4">
                        <i class="fas fa-exclamation-triangle text-lab-red text-xl"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-lab-black">Delete Template</h3>
                        <p class="text-gray-600 text-sm">This action cannot be undone</p>
                    </div>
                </div>
                
                <p class="text-gray-700 mb-6">
                    Are you sure you want to delete this slot template? Any future slots generated from this template will not be affected, but you won't be able to generate new slots from it.
                </p>
                
                <div class="flex justify-end space-x-3">
                    <button onclick="closeDeleteModal()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                        Cancel
                    </button>
                    <a id="deleteConfirmBtn" href="#" class="px-4 py-2 bg-lab-red hover:bg-lab-red-light text-white rounded-lg transition-colors">
                        Delete Template
                    </a>
                </div>
            </div>
        </div>
    </div>


    <script>
        // Delete confirmation modal
        function confirmDelete(templateId) {
            const deleteUrl = "{% url 'appointment:slot_template_delete' 0 %}".replace('0', templateId);
            document.getElementById('deleteConfirmBtn').href = deleteUrl;
            document.getElementById('deleteModal').classList.remove('hidden');
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('deleteModal');
            if (event.target === modal) {
                closeDeleteModal();
            }
        }
        
        // Toggle mobile menu (if needed)
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('hidden');
        }
    </script>
{% endblock content %}
