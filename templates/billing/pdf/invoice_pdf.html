<!DOCTYPE html>
<!-- templates/billing/pdf/invoice_pdf.html -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Invoice {{ invoice.invoice_number }}</title>
</head>
<body>
    <div class="header">
        <h1>{{ vendor.name }}</h1>
        <p>
            {{ vendor.address }}<br>
            {% if vendor.phone %}Phone: {{ vendor.phone }}<br>{% endif %}
            {% if vendor.email %}Email: {{ vendor.email }}<br>{% endif %}
            {% if vendor.registration_number %}Reg: {{ vendor.registration_number }}{% endif %}
        </p>
    </div>

    <div class="invoice-details">
        <h2>INVOICE</h2>
        <table style="width: 100%; border: none;">
            <tr>
                <td style="width: 50%; border: none;">
                    <strong>Invoice Number:</strong> {{ invoice.invoice_number }}<br>
                    <strong>Invoice Date:</strong> {{ invoice.invoice_date|date:"d M, Y" }}<br>
                    <strong>Due Date:</strong> {{ invoice.due_date|date:"d M, Y" }}<br>
                    <strong>Status:</strong> {{ invoice.get_status_display }}
                </td>
                <td style="width: 50%; border: none;">
                    <strong>Bill To:</strong><br>
                    {{ client.name }}<br>
                    {% if client.address %}{{ client.address }}<br>{% endif %}
                    {% if client.email %}{{ client.email }}<br>{% endif %}
                    {% if client.phone %}{{ client.phone }}{% endif %}
                </td>
            </tr>
        </table>
    </div>

    <div class="billing-period">
        <p><strong>Billing Period:</strong> {{ invoice.period_start|date:"d M, Y" }} to {{ invoice.period_end|date:"d M, Y" }}</p>
    </div>

    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Patient</th>
                <th>Service</th>
                <th>Description</th>
                <th class="text-right">Amount</th>
            </tr>
        </thead>
        <tbody>
            {% for record in billing_records %}
            <tr>
                <td>{{ record.service_date|date:"d M, Y" }}</td>
                <td>
                    {% if record.appointment.patient %}
                        {{ record.appointment.patient.full_name }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>{{ record.service.name }}</td>
                <td>{{ record.description|default:"-" }}</td>
                <td class="text-right">₦{{ record.insurance_portion|floatformat:2 }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" style="text-align: center;">No billing records</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="total-section">
        <div class="total-row">
            <span>Subtotal:</span>
            <span>₦{{ invoice.subtotal|floatformat:2 }}</span>
        </div>
        <div class="total-row">
            <span>Tax:</span>
            <span>₦{{ invoice.tax|floatformat:2 }}</span>
        </div>
        <div class="total-row grand-total">
            <span>Total Amount:</span>
            <span>₦{{ invoice.total_amount|floatformat:2 }}</span>
        </div>
        <div class="total-row">
            <span>Amount Paid:</span>
            <span>₦{{ invoice.amount_paid|floatformat:2 }}</span>
        </div>
        <div class="total-row grand-total" style="border-top: 2px solid #000;">
            <span>Balance Due:</span>
            <span>₦{{ balance_due|floatformat:2 }}</span>
        </div>
    </div>

    {% if payments %}
    <div style="clear: both; margin-top: 40px;">
        <h3>Payment History</h3>
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Method</th>
                    <th>Reference</th>
                    <th class="text-right">Amount</th>
                </tr>
            </thead>
            <tbody>
                {% for payment in payments %}
                <tr>
                    <td>{{ payment.payment_date|date:"d M, Y" }}</td>
                    <td>{{ payment.get_payment_method_display }}</td>
                    <td>{{ payment.reference_number|default:"-" }}</td>
                    <td class="text-right">₦{{ payment.amount|floatformat:2 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    {% if invoice.notes %}
    <div style="margin-top: 20px;">
        <strong>Notes:</strong><br>
        {{ invoice.notes|linebreaks }}
    </div>
    {% endif %}

    <div class="footer">
        <p>Thank you for your business!</p>
        <p>This is a computer-generated invoice.</p>
    </div>
</body>
</html>