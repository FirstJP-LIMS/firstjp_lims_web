{% extends 'laboratory/assets/base.html' %}
{% load static %}

{% block title %}Billing Details - {{ billing.request.request_id }}{% endblock %}

{% block content %}
<div class="container-fluid py-4 bg-light min-vh-100">
    <div class="container">
        
        <!-- Header Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
                    <div class="mb-3 mb-md-0">
                        <h1 class="h2 fw-bold text-primary mb-1">Billing Record</h1>
                        <p class="text-muted mb-0">
                            Request ID: <span class="fw-semibold">{{ test_request.request_id }}</span>
                        </p>
                    </div>
                    
                    <!-- Payment Status Badge -->
                    <div class="d-flex align-items-center">
                        {% if is_fully_paid %}
                            <span class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25 px-3 py-2">
                                <i class="fas fa-check-circle me-2"></i> Fully Paid
                            </span>
                        {% elif is_authorized %}
                            <span class="badge bg-info bg-opacity-10 text-info border border-info border-opacity-25 px-3 py-2">
                                <i class="fas fa-unlock me-2"></i> Authorized to Proceed
                            </span>
                        {% elif is_waived %}
                            <span class="badge bg-purple bg-opacity-10 text-purple border border-purple border-opacity-25 px-3 py-2">
                                <i class="fas fa-gift me-2"></i> Payment Waived
                            </span>
                        {% elif billing.payment_status == 'PARTIAL' %}
                            <span class="badge bg-warning bg-opacity-10 text-warning border border-warning border-opacity-25 px-3 py-2">
                                <i class="fas fa-exclamation-triangle me-2"></i> Partially Paid
                            </span>
                        {% else %}
                            <span class="badge bg-danger bg-opacity-10 text-danger border border-danger border-opacity-25 px-3 py-2">
                                <i class="fas fa-times-circle me-2"></i> Unpaid
                            </span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-4">
            <!-- Main Content (Left Column - 8 columns on lg) -->
            <div class="col-lg-8">
                
                <!-- Patient & Request Information Card -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white border-bottom py-3">
                        <h5 class="card-title mb-0 fw-semibold">
                            <i class="fas fa-user-circle me-2 text-primary"></i>Patient Information
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label text-muted small mb-1">Patient Name</label>
                                <p class="fw-semibold mb-0">
                                    {{ test_request.patient.first_name }} {{ test_request.patient.last_name }}
                                </p>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label text-muted small mb-1">Patient ID</label>
                                <p class="font-monospace fw-semibold mb-0">
                                    {{ test_request.patient.patient_id }}
                                </p>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label text-muted small mb-1">Phone Number</label>
                                <p class="mb-0">
                                    {{ test_request.patient.phone_number|default:"Not provided" }}
                                </p>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label text-muted small mb-1">Request Date</label>
                                <p class="mb-0">
                                    <i class="far fa-calendar me-1 text-muted"></i>
                                    {{ test_request.created_at|date:"M d, Y g:i A" }}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Test Breakdown Card -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white border-bottom py-3">
                        <h5 class="card-title mb-0 fw-semibold">
                            <i class="fas fa-flask me-2 text-primary"></i>Requested Tests
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="py-3 px-4 text-uppercase small fw-semibold">Test Name</th>
                                        <th class="py-3 px-4 text-uppercase small fw-semibold">Department</th>
                                        <th class="py-3 px-4 text-uppercase small fw-semibold text-end">Price</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for detail in test_details %}
                                    <tr>
                                        <td class="py-3 px-4">
                                            <div class="fw-medium">{{ detail.test.name }}</div>
                                            <div class="small text-muted">{{ detail.test.test_code }}</div>
                                        </td>
                                        <td class="py-3 px-4">
                                            <span class="badge bg-secondary bg-opacity-10 text-secondary">
                                                {{ detail.test.assigned_department.name|default:"General" }}
                                            </span>
                                        </td>
                                        <td class="py-3 px-4 text-end fw-semibold">
                                            ₦{{ detail.price|floatformat:2 }}
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="3" class="py-4 text-center text-muted">
                                            No tests found
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Billing Breakdown Card -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white border-bottom py-3">
                        <h5 class="card-title mb-0 fw-semibold">
                            <i class="fas fa-receipt me-2 text-primary"></i>Billing Breakdown
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-lg-8 mx-auto">
                                <div class="list-group list-group-flush">
                                    <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 py-2">
                                        <span class="text-muted">Subtotal</span>
                                        <span class="fw-semibold">₦{{ billing.subtotal|floatformat:2 }}</span>
                                    </div>
                                    
                                    {% if billing.discount > 0 %}
                                    <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 py-2">
                                        <span class="text-muted">
                                            Discount
                                            {% if billing.price_list %}
                                                <small class="text-muted">({{ billing.price_list.name }})</small>
                                            {% endif %}
                                        </span>
                                        <span class="fw-semibold text-success">-₦{{ billing.discount|floatformat:2 }}</span>
                                    </div>
                                    {% endif %}
                                    
                                    {% if billing.waiver_amount > 0 %}
                                    <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 py-2">
                                        <span class="text-muted">Waiver Amount</span>
                                        <span class="fw-semibold text-purple">-₦{{ billing.waiver_amount|floatformat:2 }}</span>
                                    </div>
                                    {% endif %}
                                    
                                    {% if billing.tax > 0 %}
                                    <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 py-2">
                                        <span class="text-muted">Tax</span>
                                        <span class="fw-semibold">₦{{ billing.tax|floatformat:2 }}</span>
                                    </div>
                                    {% endif %}
                                    
                                    <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 py-3 border-top mt-2">
                                        <span class="fw-bold fs-5">Total Amount</span>
                                        <span class="fw-bold fs-5 text-primary">₦{{ billing.total_amount|floatformat:2 }}</span>
                                    </div>
                                    
                                    {% if total_paid > 0 %}
                                    <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 py-2">
                                        <span class="text-muted">Amount Paid</span>
                                        <span class="fw-semibold text-success">₦{{ total_paid|floatformat:2 }}</span>
                                    </div>
                                    {% endif %}
                                    
                                    {% if balance_due > 0 and not is_waived %}
                                    <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 py-3 border-top mt-2">
                                        <span class="fw-bold text-danger">Balance Due</span>
                                        <span class="fw-bold fs-5 text-danger">₦{{ balance_due|floatformat:2 }}</span>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payment Timeline Card -->
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-bottom py-3">
                        <h5 class="card-title mb-0 fw-semibold">
                            <i class="fas fa-history me-2 text-primary"></i>Payment Timeline
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="timeline">
                            {% for event in timeline %}
                            <div class="timeline-item position-relative ps-4 pb-4 {% if not forloop.last %}border-start border-2{% endif %}">
                                <div class="position-absolute top-0 start-0 translate-middle">
                                    {% if event.type == 'billing' %}
                                    <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 36px; height: 36px;">
                                        <i class="fas fa-file-invoice"></i>
                                    </div>
                                    {% elif event.type == 'payment' %}
                                    <div class="bg-success bg-opacity-10 text-success rounded-circle d-flex align-items-center justify-content-center" style="width: 36px; height: 36px;">
                                        <i class="fas fa-money-bill-wave"></i>
                                    </div>
                                    {% elif event.type == 'authorization' %}
                                    <div class="bg-info bg-opacity-10 text-info rounded-circle d-flex align-items-center justify-content-center" style="width: 36px; height: 36px;">
                                        <i class="fas fa-unlock"></i>
                                    </div>
                                    {% elif event.type == 'waiver' %}
                                    <div class="bg-purple bg-opacity-10 text-purple rounded-circle d-flex align-items-center justify-content-center" style="width: 36px; height: 36px;">
                                        <i class="fas fa-gift"></i>
                                    </div>
                                    {% endif %}
                                </div>
                                
                                <div class="ms-5">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h6 class="mb-1 fw-semibold">{{ event.description }}</h6>
                                            {% if event.user %}
                                            <p class="small text-muted mb-1">
                                                By {{ event.user.get_full_name }}
                                            </p>
                                            {% endif %}
                                            <p class="small text-muted mb-2">
                                                <i class="far fa-clock me-1"></i>
                                                {{ event.date|date:"M d, Y g:i A" }}
                                            </p>
                                        </div>
                                        {% if event.amount %}
                                        <div class="fw-bold text-end">
                                            ₦{{ event.amount|floatformat:2 }}
                                        </div>
                                        {% endif %}
                                    </div>
                                    
                                    {% if event.reference %}
                                    <div class="small">
                                        <span class="badge bg-light text-dark border">Ref: {{ event.reference }}</span>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% empty %}
                            <div class="text-center py-4 text-muted">
                                <i class="fas fa-history fa-2x mb-3"></i>
                                <p class="mb-0">No activity yet</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

            </div>

            <!-- Right Sidebar - Action Panel (4 columns on lg) -->
            <div class="col-lg-4">
                
                <!-- Sample Collection Status Card -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white border-bottom py-3">
                        <h5 class="card-title mb-0 fw-semibold">Sample Collection Status</h5>
                    </div>
                    <div class="card-body text-center">
                        {% if sample %}
                            <div class="alert alert-success border-0 bg-success bg-opacity-10">
                                <div class="mb-3">
                                    <i class="fas fa-check-circle fa-2x text-success"></i>
                                </div>
                                <h6 class="fw-semibold text-success mb-2">Sample Collected</h6>
                                <p class="small text-muted mb-3">ID: {{ sample.sample_id }}</p>
                                <a href="{% url 'labs:sample_detail' pk=sample.pk %}" 
                                   class="btn btn-success btn-sm w-100">
                                    <i class="fas fa-eye me-1"></i> View Sample Details
                                </a>
                            </div>
                        {% elif can_collect_sample %}
                            <div class="alert alert-info border-0 bg-info bg-opacity-10">
                                <div class="mb-3">
                                    <i class="fas fa-vial fa-2x text-info"></i>
                                </div>
                                <h6 class="fw-semibold text-info mb-2">Ready for Collection</h6>
                                <p class="small text-muted mb-3">Payment cleared</p>
                                <a href="{% url 'labs:collect_sample' billing_pk=billing.pk %}" 
                                   class="btn btn-info btn-sm w-100">
                                    <i class="fas fa-syringe me-1"></i> Collect Sample
                                </a>
                            </div>
                        {% else %}
                            <div class="alert alert-danger border-0 bg-danger bg-opacity-10">
                                <div class="mb-3">
                                    <i class="fas fa-lock fa-2x text-danger"></i>
                                </div>
                                <h6 class="fw-semibold text-danger mb-2">Payment Required</h6>
                                <p class="small text-muted mb-3">Clear payment to proceed</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Payment Actions Card -->
                {% if not is_fully_paid and not is_waived and not sample %}
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white border-bottom py-3">
                        <h5 class="card-title mb-0 fw-semibold">Payment Actions</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            
                            <!-- Confirm Payment Button -->
                            {% if user.can_receive_payment %}
                            <button onclick="showPaymentModal()" 
                                    class="btn btn-success btn-lg d-flex align-items-center justify-content-center">
                                <i class="fas fa-money-bill-wave me-2"></i>
                                Confirm Payment
                            </button>
                            {% endif %}

                            <!-- Authorize to Proceed Button -->
                            {% if user.can_authorize_billing and not is_authorized %}
                            <button onclick="showAuthorizeModal()" 
                                    class="btn btn-info btn-lg d-flex align-items-center justify-content-center">
                                <i class="fas fa-unlock me-2"></i>
                                Authorize to Proceed
                            </button>
                            {% endif %}

                            <!-- Waive Payment Button -->
                            {% if user.can_waive_billing %}
                            <button onclick="showWaiveModal()" 
                                    class="btn btn-purple btn-lg d-flex align-items-center justify-content-center">
                                <i class="fas fa-gift me-2"></i>
                                Waive Payment
                            </button>
                            {% endif %}

                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Billing Details Card -->
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-bottom py-3">
                        <h5 class="card-title mb-0 fw-semibold">Billing Details</h5>
                    </div>
                    <div class="card-body">
                        <dl class="row mb-0">
                            <dt class="col-sm-5 text-muted small">Billing Type</dt>
                            <dd class="col-sm-7 fw-semibold">{{ billing.get_billing_type_display }}</dd>
                            
                            {% if billing.insurance_provider %}
                            <dt class="col-sm-5 text-muted small">Insurance Provider</dt>
                            <dd class="col-sm-7 fw-semibold">{{ billing.insurance_provider.name }}</dd>
                            {% endif %}
                            
                            {% if billing.corporate_client %}
                            <dt class="col-sm-5 text-muted small">Corporate Client</dt>
                            <dd class="col-sm-7 fw-semibold">{{ billing.corporate_client.name }}</dd>
                            {% endif %}
                            
                            {% if billing.price_list %}
                            <dt class="col-sm-5 text-muted small">Price List</dt>
                            <dd class="col-sm-7 fw-semibold">{{ billing.price_list.name }}</dd>
                            {% endif %}
                            
                            <dt class="col-sm-5 text-muted small">Created</dt>
                            <dd class="col-sm-7">
                                <i class="far fa-calendar me-1 text-muted"></i>
                                {{ billing.created_at|date:"M d, Y" }}
                            </dd>
                        </dl>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- Payment Modal -->
<div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header border-bottom">
                <h5 class="modal-title fw-semibold" id="paymentModalLabel">
                    <i class="fas fa-money-bill-wave me-2 text-success"></i>Confirm Payment
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{% url 'billing:confirm_payment' pk=billing.pk %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label fw-medium">Payment Method</label>
                        <select name="payment_method" required class="form-select">
                            {% for method_value, method_label in payment_methods %}
                            <option value="{{ method_value }}">{{ method_label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-medium">Amount</label>
                        <div class="input-group">
                            <span class="input-group-text">₦</span>
                            <input type="number" name="amount" step="0.01" 
                                   value="{{ balance_due }}" required
                                   class="form-control">
                        </div>
                        <div class="form-text">Balance due: ₦{{ balance_due|floatformat:2 }}</div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-medium">Transaction Reference</label>
                        <input type="text" name="transaction_reference" 
                               placeholder="Bank ref, POS receipt #, etc."
                               class="form-control">
                    </div>
                    
                    <div class="mb-0">
                        <label class="form-label fw-medium">Notes</label>
                        <textarea name="payment_notes" rows="2" 
                                  placeholder="Additional payment notes..."
                                  class="form-control"></textarea>
                    </div>
                </div>
                <div class="modal-footer border-top">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-check me-1"></i> Confirm Payment
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Authorize Modal -->
<div class="modal fade" id="authorizeModal" tabindex="-1" aria-labelledby="authorizeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header border-bottom">
                <h5 class="modal-title fw-semibold" id="authorizeModalLabel">
                    <i class="fas fa-unlock me-2 text-info"></i>Authorize to Proceed
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info border-0 bg-info bg-opacity-10 mb-4">
                    <div class="d-flex">
                        <i class="fas fa-info-circle me-2 mt-1"></i>
                        <div>
                            <p class="mb-0 small">This will allow sample collection to proceed. The debt of <strong>₦{{ billing.total_amount|floatformat:2 }}</strong> will remain tracked for later payment.</p>
                        </div>
                    </div>
                </div>
                
                <form method="POST" action="{% url 'billing:authorize_billing' pk=billing.pk %}">
                    {% csrf_token %}
                    <div class="mb-4">
                        <label class="form-label fw-medium">Authorization Reason</label>
                        <textarea name="reason" rows="3" required
                                  placeholder="e.g., Emergency case, VIP monthly billing, Insurance pre-authorization..."
                                  class="form-control"></textarea>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-info">
                            <i class="fas fa-check me-1"></i> Authorize
                        </button>
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Waive Payment Modal -->
<div class="modal fade" id="waiveModal" tabindex="-1" aria-labelledby="waiveModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header border-bottom">
                <h5 class="modal-title fw-semibold" id="waiveModalLabel">
                    <i class="fas fa-gift me-2 text-purple"></i>Waive Payment
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning border-0 bg-warning bg-opacity-10 mb-4">
                    <div class="d-flex">
                        <i class="fas fa-exclamation-triangle me-2 mt-1"></i>
                        <div>
                            <p class="mb-0 small">This will forgive the debt. No payment will be expected.</p>
                        </div>
                    </div>
                </div>
                
                <form method="POST" action="{% url 'billing:waive_billing' pk=billing.pk %}">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label class="form-label fw-medium">Waiver Type</label>
                        <select name="waiver_type" id="waiverType" onchange="togglePartialAmount()" 
                                class="form-select">
                            <option value="full">Full Waiver (₦{{ billing.total_amount|floatformat:2 }})</option>
                            <option value="partial">Partial Waiver</option>
                        </select>
                    </div>
                    
                    <div id="partialAmountDiv" class="mb-3 d-none">
                        <label class="form-label fw-medium">Waiver Amount</label>
                        <div class="input-group">
                            <span class="input-group-text">₦</span>
                            <input type="number" name="partial_waiver_amount" step="0.01" 
                                   max="{{ billing.total_amount }}"
                                   class="form-control">
                        </div>
                        <div class="form-text">Maximum: ₦{{ billing.total_amount|floatformat:2 }}</div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label fw-medium">Waiver Reason</label>
                        <textarea name="waiver_reason" rows="3" required
                                  placeholder="e.g., Charity case, Staff medical benefit, Goodwill gesture..."
                                  class="form-control"></textarea>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-purple">
                            <i class="fas fa-check me-1"></i> Waive Payment
                        </button>
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_css %}
<style>
:root {
    --bs-purple: #6f42c1;
}

.bg-purple {
    background-color: var(--bs-purple) !important;
}

.text-purple {
    color: var(--bs-purple) !important;
}

.btn-purple {
    background-color: var(--bs-purple);
    border-color: var(--bs-purple);
    color: white;
}

.btn-purple:hover {
    background-color: #5a36a8;
    border-color: #5a36a8;
    color: white;
}

.border-purple {
    border-color: var(--bs-purple) !important;
}

.timeline {
    position: relative;
}

.timeline-item:last-child {
    padding-bottom: 0 !important;
}

.timeline-item:last-child .border-start {
    border: none !important;
}

.font-monospace {
    font-family: 'SFMono-Regular', Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
}

.table-hover tbody tr:hover {
    background-color: rgba(var(--bs-primary-rgb), 0.04);
}

.alert {
    border-radius: 0.75rem;
}

.card {
    border-radius: 0.75rem;
}

.modal-content {
    border-radius: 1rem;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Toggle partial waiver amount field
function togglePartialAmount() {
    const waiverType = document.getElementById('waiverType').value;
    const partialDiv = document.getElementById('partialAmountDiv');
    
    if (waiverType === 'partial') {
        partialDiv.classList.remove('d-none');
    } else {
        partialDiv.classList.add('d-none');
    }
}

// Modal display functions
function showPaymentModal() {
    var paymentModal = new bootstrap.Modal(document.getElementById('paymentModal'));
    paymentModal.show();
}

function showAuthorizeModal() {
    var authorizeModal = new bootstrap.Modal(document.getElementById('authorizeModal'));
    authorizeModal.show();
}

function showWaiveModal() {
    var waiveModal = new bootstrap.Modal(document.getElementById('waiveModal'));
    waiveModal.show();
}

// Initialize if any other JS is needed
document.addEventListener('DOMContentLoaded', function() {
    // Any additional initialization
});
</script>
{% endblock %}
